<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>게시글 목록</title>

  <!-- 비동기 삭제 및 수정 스크립트 -->
  <script>
  function deletePost(button) {
	  const postId = button.getAttribute("data-id");

	  if (!confirm("정말 삭제하시겠습니까?")) return;

	  fetch(`/posts/delete/${postId}`, {
	    method: "DELETE",
	    headers: {
	      "X-Requested-With": "XMLHttpRequest"
	    }
	  })
	  .then(response => {
	    if (response.ok) {
	      const row = button.closest("tr");
	      row.remove(); // 게시글 삭제 성공 시 UI에서 삭제
	    } else {
	      response.text().then(message => {
	        alert(message); // 실패 시 메시지 표시
	      });
	    }
	  })
	  .catch(error => {
	    console.error("삭제 중 오류:", error);
	    alert("오류가 발생했습니다.");
	  });
	}

  </script>

<style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f4f7fa;
      margin: 0;
      padding: 0;
    }

    .board-container {
      max-width: 1100px;
      margin: 30px auto;
      padding: 20px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .board-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }

    .btn-write {
      background-color: #3498db;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      text-decoration: none;
    }

    .btn-write:hover {
      background-color: #2980b9;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
    }

    th, td {
      padding: 15px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }

    th {
      background-color: #2c3e50;
      color: white;
      font-weight: bold;
    }

    tr:hover {
      background-color: #ecf0f1;
    }

    .post-title {
      color: #3498db;
      text-decoration: none;
      font-weight: 600;
    }

    .post-title:hover {
      text-decoration: underline;
    }

    .delete-btn, .edit-btn {
      padding: 8px 15px;
      margin: 0 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      color: white;
    }

    .delete-btn {
      background-color: #e74c3c;
    }

    .delete-btn:hover {
      background-color: #c0392b;
    }

    .edit-btn {
      background-color: #f39c12;
    }

    .edit-btn:hover {
      background-color: #e67e22;
    }

    @media (max-width: 768px) {
      .board-container {
        padding: 15px;
      }

      th, td {
        padding: 10px;
      }

      .btn-write {
        font-size: 14px;
        padding: 8px 16px;
      }
    }
  </style>
</head>

<body>
  <section>
    <div class="board-container">
      <div class="board-header">
        <h2>게시글 목록</h2>
        <a th:href="@{/post/create}" class="btn-write">글 작성</a>
      </div>

      <table class="table">
        <thead>
          <tr>
            <th>글번호</th>
            <th>제목</th>
            <th>내용</th>
            <th>지역</th>
            <th>작성자</th>
            <th>조회수</th>
            <th>설정</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="post : ${posts}">
            <td th:text="${post.post_id}"></td>
            <td class="post-title">
              <a th:href="@{/post/view/{id}(id=${post.post_id})}" class="post-title" th:text="${post.title}"></a>
            </td>
            <td class="post-content" th:text="${#strings.abbreviate(post.content, 30)}"></td>
            <td th:text="${post.region}"></td>
            <td th:text="${post.username}"></td>
            <td th:text="${post.views}"></td>
            <td>
              <button type="button"
                      class="edit-btn"
                      th:data-id="${post.post_id}"
                      onclick="editPost(this)">수정</button> |
              <button type="button"
                      class="delete-btn"
                      th:data-id="${post.post_id}"
                      onclick="deletePost(this)">삭제</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</body>
</html>
